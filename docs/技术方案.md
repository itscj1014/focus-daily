# Focus-Daily 技术方案文档

## 项目概述

**项目名称**: Focus-Daily  
**项目类型**: 跨平台应用  
**目标平台**: 
- **主要平台**: Windows 10+、macOS 11+、Linux (Ubuntu 18.04+)
- **扩展平台**: 移动端后续采用兼容技术（React Native Web 或 PWA）  
**开发框架**: Tauri 2.0+ + Vue 3.4+ + Tailwind CSS 3.4+  
**开发语言**: Rust (后端) + TypeScript (前端)  
**开发策略**: 桌面优先，移动端采用兼容技术

Focus-Daily是一款基于科学专注理论的时间管理应用，采用90分钟专注+20分钟休息的主周期，配合3-5分钟随机微休息机制，帮助用户提高专注力和工作效率。

## 技术方案重新评估

### 为什么选择 Tauri + Vue3 + Tailwind CSS

#### Tauri 优势分析
1. **极致轻量**: 比Electron应用小10-20倍，内存占用仅为Electron的1/10
2. **卓越性能**: Rust后端提供原生级性能，启动速度快3-5倍
3. **安全性强**: Rust内存安全特性，避免常见安全漏洞
4. **资源消耗低**: CPU和内存使用显著低于Electron
5. **原生集成**: 更好的系统API访问和桌面体验
6. **现代化**: 2024年最新的桌面应用开发框架

#### Vue3 + TypeScript 优势
1. **开发效率**: 组合式API，响应性系统，开发体验优秀
2. **类型安全**: TypeScript提供完整的类型检查
3. **生态成熟**: 丰富的组件库和工具链
4. **学习成本低**: 相比Flutter的Dart，更容易掌握
5. **团队熟悉度**: 前端技术栈更容易招聘和培训

#### Tailwind CSS 优势
1. **快速开发**: 实用工具优先，开发速度快
2. **现代化UI**: 支持最新的设计趋势
3. **可定制性**: 高度可配置的设计系统
4. **响应式**: 原生支持响应式设计
5. **体积优化**: 构建时自动清理未使用的样式

## 核心技术栈

### 前端框架
- **Vue 3.4+**: 组合式API，<script setup>语法
- **TypeScript 5.0+**: 类型安全，开发体验
- **Tailwind CSS 3.4+**: 现代化样式解决方案
- **Vite 5.0+**: 超快的构建工具和开发服务器

### 桌面应用框架
- **Tauri 2.0**: Rust后端，Web前端的桌面应用框架
- **tauri-apps/api**: Tauri前端API
- **tauri-apps/cli**: 命令行工具

### 状态管理
- **Pinia**: Vue 3官方推荐的状态管理库
  - 类型安全
  - 支持TypeScript
  - 优秀的开发者工具
  - 轻量级

### 路由管理
- **Vue Router 4**: Vue 3官方路由解决方案

### UI组件库
- **Headless UI**: 无样式的可访问性组件
- **Heroicons**: Tailwind官方图标库
- **VueUse**: Vue组合式函数工具库
- **@tailwindcss/forms**: 表单样式增强
- **@tailwindcss/typography**: 文字排版增强

### 桌面特性增强

#### 1. Tauri插件生态
- **tauri-plugin-window-state**: 窗口状态管理
- **tauri-plugin-system-tray**: 系统托盘
- **tauri-plugin-notification**: 桌面通知
- **tauri-plugin-global-shortcut**: 全局快捷键
- **tauri-plugin-autostart**: 开机自启动
- **tauri-plugin-updater**: 应用自动更新
- **tauri-plugin-fs**: 文件系统访问
- **tauri-plugin-dialog**: 原生对话框

#### 2. 音频处理
- **rodio**: Rust音频播放库（后端）
- **Web Audio API**: 前端音频控制
- **自定义音频插件**: Tauri命令处理音频

#### 3. 数据存储
- **tauri-plugin-sql**: SQLite数据库
- **serde**: Rust序列化/反序列化
- **sqlx**: 异步数据库访问

### 技术栈对比分析

| 方面 | Tauri + Vue3 | Flutter | Electron |
|------|-------------|---------|----------|
| 应用体积 | 10-15MB | 20-30MB | 100-150MB |
| 内存占用 | 30-50MB | 50-80MB | 150-300MB |
| 启动速度 | 极快(0.5s) | 快(1-2s) | 慢(3-5s) |
| 开发效率 | 高 | 中等 | 高 |
| 学习成本 | 低 | 高(Dart) | 低 |
| 性能 | 优秀 | 良好 | 一般 |
| 安全性 | 很高 | 高 | 中等 |
| 桌面集成 | 原生 | 良好 | 一般 |

## 项目架构设计

### 整体架构
```
┌─────────────────────────────────────┐
│            Frontend (Vue3)          │  ← 用户界面层
├─────────────────────────────────────┤
│            Tauri Commands           │  ← API桥接层
├─────────────────────────────────────┤
│            Rust Backend             │  ← 业务逻辑层
├─────────────────────────────────────┤
│            Native APIs              │  ← 系统接口层
└─────────────────────────────────────┘
```

### 目录结构
```
focus-daily/
├── src-tauri/                 # Rust后端
│   ├── src/
│   │   ├── main.rs            # 应用入口
│   │   ├── commands/          # Tauri命令
│   │   ├── database/          # 数据库相关
│   │   ├── audio/             # 音频服务
│   │   ├── timer/             # 定时器服务
│   │   ├── notification/      # 通知服务
│   │   └── utils/             # 工具函数
│   ├── Cargo.toml            # Rust依赖
│   ├── tauri.conf.json       # Tauri配置
│   └── icons/                # 应用图标
├── src/                      # Vue3前端
│   ├── components/           # Vue组件
│   ├── views/               # 页面视图
│   ├── stores/              # Pinia状态管理
│   ├── composables/         # 组合式函数
│   ├── utils/               # 工具函数
│   ├── types/               # TypeScript类型
│   └── styles/              # Tailwind样式
├── public/                  # 静态资源
├── dist/                    # 构建输出
└── package.json            # 前端依赖
```

## 核心功能模块设计

### 1. 定时器系统 (Rust + Vue3)

#### Rust后端实现
```rust
// src-tauri/src/timer/mod.rs
#[derive(Clone, Debug, Serialize, Deserialize)]
pub struct TimerState {
    pub is_running: bool,
    pub current_phase: TimerPhase,
    pub remaining_time: u64,
    pub cycle_count: u32,
}

#[tauri::command]
pub async fn start_timer(state: State<TimerManager>) -> Result<(), String> {
    state.start().await
}

#[tauri::command]
pub async fn pause_timer(state: State<TimerManager>) -> Result<(), String> {
    state.pause().await
}
```

#### Vue3前端实现
```typescript
// src/stores/timer.ts
export const useTimerStore = defineStore('timer', () => {
  const timerState = ref<TimerState>({
    isRunning: false,
    currentPhase: 'focus',
    remainingTime: 5400, // 90分钟
    cycleCount: 0
  })

  const startTimer = async () => {
    await invoke('start_timer')
  }

  const pauseTimer = async () => {
    await invoke('pause_timer')
  }

  return { timerState, startTimer, pauseTimer }
})
```

### 2. 音频系统

#### Rust音频服务
```rust
// src-tauri/src/audio/mod.rs
use rodio::{Decoder, OutputStream, Sink};

#[tauri::command]
pub async fn play_audio(audio_type: String) -> Result<(), String> {
    let audio_service = AudioService::new();
    audio_service.play(audio_type).await
}
```

#### Vue3音频控制
```vue
<!-- src/components/AudioSettings.vue -->
<template>
  <div class="audio-settings">
    <div class="grid grid-cols-2 gap-4">
      <div v-for="audio in audioTypes" :key="audio.type">
        <button 
          @click="previewAudio(audio.type)"
          class="btn-primary w-full">
          预览 {{ audio.name }}
        </button>
      </div>
    </div>
  </div>
</template>
```

### 3. 桌面特性实现

#### 系统托盘
```rust
// src-tauri/src/main.rs
use tauri::{CustomMenuItem, SystemTray, SystemTrayMenu, SystemTrayEvent};

fn create_system_tray() -> SystemTray {
    let quit = CustomMenuItem::new("quit".to_string(), "退出");
    let show = CustomMenuItem::new("show".to_string(), "显示");
    let tray_menu = SystemTrayMenu::new()
        .add_item(show)
        .add_item(quit);
    
    SystemTray::new().with_menu(tray_menu)
}
```

#### 全局快捷键
```rust
// 注册全局快捷键
use tauri_plugin_global_shortcut::{Code, Modifiers, ShortcutManager};

#[tauri::command]
async fn register_shortcuts(shortcut_manager: State<ShortcutManager>) -> Result<(), String> {
    shortcut_manager.register("Ctrl+Space", || {
        // 开始/暂停定时器
    })?;
    Ok(())
}
```

### 4. 数据存储方案

#### SQLite数据库设计
```rust
// src-tauri/src/database/mod.rs
use sqlx::{SqlitePool, Row};

#[derive(sqlx::FromRow, Serialize, Deserialize)]
pub struct FocusSession {
    pub id: i64,
    pub start_time: chrono::DateTime<chrono::Utc>,
    pub end_time: Option<chrono::DateTime<chrono::Utc>>,
    pub focus_duration: i32,
    pub break_duration: i32,
    pub micro_breaks_count: i32,
    pub completed: bool,
}

pub async fn create_session(pool: &SqlitePool, session: &FocusSession) -> Result<i64, sqlx::Error> {
    let result = sqlx::query(
        "INSERT INTO focus_sessions (start_time, focus_duration, break_duration) VALUES (?, ?, ?)"
    )
    .bind(&session.start_time)
    .bind(session.focus_duration)
    .bind(session.break_duration)
    .execute(pool)
    .await?;
    
    Ok(result.last_insert_rowid())
}
```

## UI/UX设计方案

### Material Design 3 + Tailwind CSS实现

#### 设计系统配置
```typescript
// tailwind.config.js
module.exports = {
  content: ['./src/**/*.{vue,js,ts}'],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#f0f9ff',
          500: '#3b82f6',
          900: '#1e3a8a',
        },
        surface: {
          50: '#fafafa',
          100: '#f5f5f5',
          900: '#171717',
        }
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
      },
      animation: {
        'pulse-focus': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
      }
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('@tailwindcss/typography'),
  ],
}
```

#### 响应式组件设计
```vue
<!-- src/components/TimerDisplay.vue -->
<template>
  <div class="timer-display bg-surface-50 dark:bg-surface-900 rounded-2xl p-8 shadow-xl">
    <div class="text-center">
      <!-- 圆形进度条 -->
      <div class="relative w-64 h-64 mx-auto mb-8">
        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
          <circle
            cx="50" cy="50" r="45"
            fill="none" stroke="currentColor"
            stroke-width="2"
            class="text-surface-200 dark:text-surface-700"
          />
          <circle
            cx="50" cy="50" r="45"
            fill="none" stroke="currentColor"
            stroke-width="4"
            stroke-linecap="round"
            class="text-primary-500 transition-all duration-1000 ease-in-out"
            :stroke-dasharray="circumference"
            :stroke-dashoffset="dashOffset"
          />
        </svg>
        
        <!-- 时间显示 -->
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="text-center">
            <div class="text-4xl font-bold text-surface-900 dark:text-surface-50">
              {{ formattedTime }}
            </div>
            <div class="text-sm text-surface-600 dark:text-surface-400 mt-2">
              {{ currentPhase === 'focus' ? '专注时间' : '休息时间' }}
            </div>
          </div>
        </div>
      </div>
      
      <!-- 控制按钮 -->
      <div class="flex justify-center space-x-4">
        <button
          @click="toggleTimer"
          class="btn-primary px-8 py-3 rounded-full font-semibold text-lg
                 transition-all duration-200 hover:scale-105 active:scale-95"
        >
          {{ isRunning ? '暂停' : '开始' }}
        </button>
        <button
          @click="resetTimer"
          class="btn-secondary px-6 py-3 rounded-full font-semibold"
        >
          重置
        </button>
      </div>
    </div>
  </div>
</template>
```

## 性能优化方案

### 1. Rust后端优化
- **异步处理**: 使用tokio异步运行时
- **内存管理**: Rust零成本抽象和所有权系统
- **编译优化**: release模式编译优化

### 2. Vue3前端优化
- **Tree-shaking**: Vite自动移除未使用代码
- **懒加载**: 路由和组件按需加载
- **响应式优化**: 合理使用ref和reactive

### 3. Tailwind CSS优化
- **JIT编译**: 实时生成需要的样式
- **PurgeCSS**: 自动清理未使用的CSS
- **压缩**: 生产环境CSS压缩

## 开发环境配置

### 系统要求
- **Node.js**: 18.0+
- **Rust**: 1.70+
- **Tauri CLI**: 2.0+
- **操作系统**: Windows 10+, macOS 11+, Ubuntu 18.04+

### 开发工具配置
```bash
# 安装Tauri CLI
npm install -g @tauri-apps/cli

# 创建项目
npm create tauri-app focus-daily
cd focus-daily

# 安装依赖
npm install

# 开发模式
npm run tauri dev

# 构建应用
npm run tauri build
```

### VS Code配置
```json
// .vscode/settings.json
{
  "rust-analyzer.checkOnSave.command": "clippy",
  "typescript.preferences.importModuleSpecifier": "relative",
  "tailwindCSS.includeLanguages": {
    "vue": "html"
  },
  "files.associations": {
    "*.rs": "rust"
  }
}
```

## 跨平台兼容性

### 条件编译
```rust
// 平台特定代码
#[cfg(target_os = "windows")]
fn windows_specific_function() {
    // Windows特定实现
}

#[cfg(target_os = "macos")]
fn macos_specific_function() {
    // macOS特定实现
}

#[cfg(target_os = "linux")]
fn linux_specific_function() {
    // Linux特定实现
}
```

### 响应式设计
```vue
<template>
  <div class="app-container">
    <!-- 桌面布局 -->
    <div class="hidden lg:block">
      <DesktopLayout />
    </div>
    
    <!-- 小屏幕布局 -->
    <div class="lg:hidden">
      <CompactLayout />
    </div>
  </div>
</template>
```

## 移动端兼容策略

由于Tauri专注于桌面应用，移动端将采用以下兼容技术：

### 方案一: PWA (推荐)
- **技术栈**: Vue3 + Vite + PWA插件
- **优势**: 代码复用率高，开发成本低
- **实现**: 将现有Vue3代码打包为PWA应用

### 方案二: React Native Web
- **技术栈**: React Native + React Native Web
- **优势**: 真正的跨平台
- **实现**: 重写部分组件以适配React Native

### 方案三: Capacitor
- **技术栈**: Vue3 + Capacitor
- **优势**: 近似原生体验
- **实现**: 使用Capacitor打包Vue3应用

## 发布和分发策略

### 桌面端发布

#### Windows
- **NSIS安装程序**: 传统安装方式
- **MSI包**: 企业级部署
- **便携版**: 免安装绿色版

#### macOS
- **DMG镜像**: 标准分发格式
- **PKG安装包**: 系统级安装
- **App Store**: 官方应用商店

#### Linux
- **AppImage**: 通用Linux应用格式
- **Snap**: Ubuntu应用商店
- **Flatpak**: Flathub应用商店
- **deb/rpm**: 系统包管理器

### 自动更新机制
```rust
// src-tauri/src/updater.rs
use tauri_plugin_updater::UpdaterExt;

#[tauri::command]
async fn check_for_updates(app: AppHandle) -> Result<bool, String> {
    if let Some(update) = app.updater().check().await? {
        let downloaded = update.download().await?;
        downloaded.install().await?;
        Ok(true)
    } else {
        Ok(false)
    }
}
```

## 项目时间规划 (桌面优先)

### Phase 1: 桌面应用开发 (6周)

| 阶段 | 时间 | 主要工作 | 技术重点 |
|------|------|----------|----------|
| 架构搭建 | 1周 | Tauri项目初始化、开发环境配置 | Rust + Vue3集成 |
| 核心功能 | 2周 | 定时器、音频、数据存储 | Tauri Commands |
| 桌面特性 | 2周 | 系统托盘、快捷键、通知 | 桌面API集成 |
| UI/UX | 1周 | 界面美化、动画效果 | Tailwind + Vue3 |

### Phase 2: 移动端兼容 (3周)

| 阶段 | 时间 | 主要工作 | 技术重点 |
|------|------|----------|----------|
| PWA适配 | 2周 | Service Worker、离线支持 | PWA技术 |
| 移动优化 | 1周 | 触摸交互、响应式布局 | 移动端适配 |

### Phase 3: 发布准备 (1周)

| 阶段 | 时间 | 主要工作 | 技术重点 |
|------|------|----------|----------|
| 打包发布 | 1周 | 多平台打包、签名、分发 | CI/CD流程 |

## 总结

采用 **Tauri + Vue3 + Tailwind CSS** 技术栈具有以下核心优势：

### 技术优势
1. **极致性能**: Tauri提供接近原生的性能表现
2. **现代化**: 使用最新的Web技术和Rust生态
3. **开发效率**: Vue3 + TypeScript + Tailwind的组合开发体验优秀
4. **安全可靠**: Rust的内存安全特性确保应用稳定性

### 商业优势
1. **成本控制**: 相比Flutter，学习成本和开发成本更低
2. **团队熟悉**: 前端技术栈更容易招聘和培训
3. **未来扩展**: 易于扩展到Web端和移动端
4. **维护性**: 代码结构清晰，维护成本低

### 生态优势
1. **Tauri生态**: 快速发展的Rust桌面应用生态
2. **Vue生态**: 成熟完善的前端生态系统
3. **社区支持**: 活跃的开源社区和丰富的学习资源

这个技术方案能够满足Focus-Daily项目的所有需求，通过桌面优先策略确保快速开发和优秀的用户体验，同时为后续的移动端扩展奠定坚实基础。 